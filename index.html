<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaruusalus Väistelypeli</title>
    <style>
        body { margin: 0; overflow: hidden; text-align: center; }
        canvas { background: black; display: block; margin: auto; }
        #score {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 20px;
            font-family: Arial, sans-serif;
        }
        #restartButton {
            margin-top: 10px;
            padding: 10px;
            font-size: 20px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        #restartButton:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="score">Pisteet: 0</div>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreDisplay = document.getElementById("score");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Ladataan kuvat
        const images = {
            ship: new Image(),
            bullet: new Image(),
            obstacle: new Image(),
            ufo: new Image(),
            fastUfo: new Image(),
            background: new Image()
        };
        images.ship.src = "alus.png"; // Paikallinen tiedosto
        images.bullet.src = "rockets_PNG13272.png"; // Paikallinen tiedosto
        images.obstacle.src = "ufo.png"; // Paikallinen tiedosto
        images.ufo.src = "ufo2.png"; // Paikallinen tiedosto
        images.fastUfo.src = "ufo3.png"; // Paikallinen tiedosto
        images.background.src = "skynews-planet-earth-sun_6072586.jpg"; // Paikallinen tiedosto

        let ship, obstacles, bullets, ufo, fastUfo, keys, obstacleSpeed, canShoot, score, scoreInterval;

        function init() {
            ship = { x: 150, y: canvas.height / 2, width: 100, height: 100, speed: 5, alive: true };
            obstacles = [];
            bullets = [];
            ufo = null;
            fastUfo = null;
            keys = {};
            obstacleSpeed = 5;
            canShoot = true;
            score = 0;
            scoreDisplay.textContent = "Pisteet: 0";

            clearInterval(scoreInterval);
            scoreInterval = setInterval(() => {
                if (ship.alive) {
                    score += 1;
                    scoreDisplay.textContent = "Pisteet: " + score;
                }
            }, 1000);

            // Lisätty esteiden luontiväli
            setInterval(() => {
                const size = Math.random() * 100 + 20; // Satunnainen koko 20 - 120 välillä
                const hits = Math.ceil(size / 20); // Osumien määrä suhteessa kokoon
                obstacles.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - size),
                    width: size,
                    height: size,
                    hits: hits
                });
            }, 1000);

            // Lisätty UFO:n luontiväli
            setInterval(() => {
                if (!ufo) {
                    const size = Math.random() * 100 + 20; // Satunnainen koko 20 - 120 välillä
                    const hits = Math.ceil(size / 20); // Osumien määrä suhteessa kokoon
                    ufo = {
                        x: canvas.width,
                        y: Math.random() * (canvas.height - size),
                        width: size,
                        height: size,
                        hits: hits
                    };
                }
            }, 10000);

            // Lisätty nopean UFO:n luontiväli
            setInterval(() => {
                if (!fastUfo) {
                    const size = Math.random() * 100 + 20; // Satunnainen koko 20 - 120 välillä
                    const hits = Math.ceil(size / 20); // Osumien määrä suhteessa kokoon
                    fastUfo = {
                        x: canvas.width,
                        y: Math.random() * (canvas.height - size),
                        width: size,
                        height: size,
                        hits: hits,
                        speed: obstacleSpeed * 2 // Kaksi kertaa nopeampi kuin este
                    };
                }
            }, 15000);
        }

        window.addEventListener("keydown", (e) => {
            keys[e.key] = true;
            if (e.key === " " && canShoot) {
                shoot();
                canShoot = false;
            }
        });

        window.addEventListener("keyup", (e) => {
            keys[e.key] = false;
            if (e.key === " ") canShoot = true;
        });

        function shoot() {
            bullets.push({
                x: ship.x + ship.width,
                y: ship.y + ship.height / 2 - 5,
                width: 10,
                height: 10,
                speed: 7
            });
        }

        // Törmäystunnistus ympyrän avulla
        function checkCircleCollision(circle1, circle2) {
            const dx = circle1.x - circle2.x;
            const dy = circle1.y - circle2.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            return distance < (circle1.radius + circle2.radius);
        }

        function update() {
            if (keys["ArrowUp"] && ship.y > 0) ship.y -= ship.speed;
            if (keys["ArrowDown"] && ship.y + ship.height < canvas.height) ship.y += ship.speed;
            if (keys["ArrowLeft"] && ship.x > 0) ship.x -= ship.speed;
            if (keys["ArrowRight"] && ship.x + ship.width < canvas.width) ship.x += ship.speed;

            bullets.forEach((bullet, index) => {
                bullet.x += bullet.speed;
                if (bullet.x > canvas.width) bullets.splice(index, 1);
            });

            obstacles.forEach((ob, index) => {
                ob.x -= obstacleSpeed;
                if (ob.x + ob.width < 0) obstacles.splice(index, 1);

                bullets.forEach((bullet, bulletIndex) => {
                    if (checkCircleCollision({
                        x: bullet.x + bullet.width / 2,
                        y: bullet.y + bullet.height / 2,
                        radius: bullet.width / 2
                    }, {
                        x: ob.x + ob.width / 2,
                        y: ob.y + ob.height / 2,
                        radius: ob.width / 2
                    })) {
                        bullets.splice(bulletIndex, 1);
                        ob.hits--;
                        ob.width -= ob.width / (ob.hits + 1); // Pienennä leveys suhteessa jäljellä oleviin osumiin
                        ob.height -= ob.height / (ob.hits + 1); // Pienennä korkeus suhteessa jäljellä oleviin osumiin
                        if (ob.hits <= 0) {
                            obstacles.splice(index, 1);
                            score += 5;
                            scoreDisplay.textContent = "Pisteet: " + score;
                        }
                    }
                });

                if (ob.hits > 0 && checkCircleCollision({
                    x: ship.x + ship.width / 2,
                    y: ship.y + ship.height / 2,
                    radius: ship.width / 2
                }, {
                    x: ob.x + ob.width / 2,
                    y: ob.y + ob.height / 2,
                    radius: ob.width / 2
                })) {
                    ship.alive = false;
                }
            });

            if (ufo) {
                let dx = ship.x - ufo.x;
                let dy = ship.y - ufo.y;
                let dist = Math.sqrt(dx * dx + dy * dy);

                ufo.x += (dx / dist);
                ufo.y += (dy / dist);

                if (ufo.hits > 0 && checkCircleCollision({
                    x: ship.x + ship.width / 2,
                    y: ship.y + ship.height / 2,
                    radius: ship.width / 2
                }, {
                    x: ufo.x + ufo.width / 2,
                    y: ufo.y + ufo.height / 2,
                    radius: ufo.width / 2
                })) {
                    ship.alive = false;
                }
            }

            if (fastUfo) {
                fastUfo.x -= fastUfo.speed;
                if (fastUfo.x + fastUfo.width < 0) fastUfo = null;

                bullets.forEach((bullet, bulletIndex) => {
                    if (checkCircleCollision({
                        x: bullet.x + bullet.width / 2,
                        y: bullet.y + bullet.height / 2,
                        radius: bullet.width / 2
                    }, {
                        x: fastUfo.x + fastUfo.width / 2,
                        y: fastUfo.y + fastUfo.height / 2,
                        radius: fastUfo.width / 2
                    })) {
                        bullets.splice(bulletIndex, 1);
                        fastUfo.hits--;
                        fastUfo.width -= fastUfo.width / (fastUfo.hits + 1); // Pienennä leveys suhteessa jäljellä oleviin osumiin
                        fastUfo.height -= fastUfo.height / (fastUfo.hits + 1); // Pienennä korkeus suhteessa jäljellä oleviin osumiin
                        if (fastUfo.hits <= 0) {
                            fastUfo = null;
                            score += 20;
                            scoreDisplay.textContent = "Pisteet: " + score;
                        }
                    }
                });

                if (fastUfo && fastUfo.hits > 0 && checkCircleCollision({
                    x: ship.x + ship.width / 2,
                    y: ship.y + ship.height / 2,
                    radius: ship.width / 2
                }, {
                    x: fastUfo.x + fastUfo.width / 2,
                    y: fastUfo.y + fastUfo.height / 2,
                    radius: fastUfo.width / 2
                })) {
                    ship.alive = false;
                }
            }
        }

        function draw() {
            ctx.drawImage(images.background, 0, 0, canvas.width, canvas.height);
            ctx.drawImage(images.ship, ship.x, ship.y, ship.width, ship.height);

            bullets.forEach(bullet => {
                ctx.drawImage(images.bullet, bullet.x, bullet.y, bullet.width, bullet.height);
            });

            obstacles.forEach(ob => {
                if (ob.hits > 0) {
                    ctx.drawImage(images.obstacle, ob.x, ob.y, ob.width, ob.height);
                }
            });

            if (ufo && ufo.hits > 0) {
                ctx.drawImage(images.ufo, ufo.x, ufo.y, ufo.width, ufo.height);
            }

            if (fastUfo && fastUfo.hits > 0) {
                ctx.drawImage(images.fastUfo, fastUfo.x, fastUfo.y, fastUfo.width, fastUfo.height);
            }
        }

        function gameLoop() {
            if (ship.alive) {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            } else {
                clearInterval(scoreInterval);
                ctx.fillStyle = "white";
                ctx.font = "30px Arial";
                ctx.fillText("Game Over", canvas.width / 2 - 80, canvas.height / 2);
                ctx.fillText("Pisteet: " + score, canvas.width / 2 - 80, canvas.height / 2 + 30);
                const restartButton = document.createElement("button");
                restartButton.textContent = "Uudelleen";
                restartButton.id = "restartButton";
                document.body.appendChild(restartButton);
                restartButton.addEventListener("click", () => {
                    document.body.removeChild(restartButton);
                    init();
                    gameLoop();
                });
            }
        }

        init();
        gameLoop();
    </script>
</body>
</html>
