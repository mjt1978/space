<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaruusalus VÃ¤istelypeli</title>
    <style>
        body { margin: 0; overflow: hidden; text-align: center; }
        canvas { background: black; display: block; margin: auto; }
        #score {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 20px;
            font-family: Arial, sans-serif;
        }
        #restartButton {
            margin-top: 100px;
            padding: 10px;
            font-size: 20px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #restartButton:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="score">Pisteet: 0</div>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreDisplay = document.getElementById("score");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Ladataan kuvat
        const images = {
            ship: new Image(),
            bullet: new Image(),
            ufo: new Image(),
            background: new Image()
        };
        images.ship.src = "alus.png"; // Paikallinen tiedosto
        images.bullet.src = "rockets_PNG13272.png"; // Paikallinen tiedosto
        images.ufo.src = "ufo2.png"; // Paikallinen tiedosto
        images.background.src = "skynews-planet-earth-sun_6072586.jpg"; // Paikallinen tiedosto

        let ship, ufo, bullets, keys, ufoSpeed, canShoot, score, scoreInterval, ufoShootingInterval;
        let ufoBullets = [];

        // Kuvalatauksen varmistus
        let imagesLoaded = 0;
        const totalImages = Object.keys(images).length;

        Object.values(images).forEach(img => {
            img.onload = () => {
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    init();
                    gameLoop();
                }
            };
        });

        function init() {
            ship = { x: 150, y: canvas.height / 2, width: 100, height: 100, speed: 5, alive: true };
            ufo = { x: canvas.width - 150, y: canvas.height / 2, width: 100, height: 100, speed: 2.5, hits: 5 };
            bullets = [];
            keys = {};
            ufoSpeed = 2.5;
            canShoot = true;
            score = 0;
            scoreDisplay.textContent = "Pisteet: 0";

            clearInterval(scoreInterval);
            clearInterval(ufoShootingInterval);
            ufoShootingInterval = setInterval(ufoShoot, 3000);

            scoreInterval = setInterval(() => {
                if (ship.alive) {
                    score += 1;
                    scoreDisplay.textContent = "Pisteet: " + score;
                }
            }, 1000);
        }

        function resetGame() {
            clearInterval(scoreInterval);
            clearInterval(ufoShootingInterval);

            ship = { x: 150, y: canvas.height / 2, width: 100, height: 100, speed: 5, alive: true };
            ufo = { x: canvas.width - 150, y: canvas.height / 2, width: 100, height: 100, speed: ufoSpeed, hits: 5 };
            bullets = [];
            keys = {};
            canShoot = true;
            score = 0;
            scoreDisplay.textContent = "Pisteet: 0";

            ufoBullets = [];
        }

        window.addEventListener("keydown", (e) => {
            keys[e.key] = true;
            if (e.key === " " && canShoot) {
                shoot();
                canShoot = false;
            }
        });

        window.addEventListener("keyup", (e) => {
            keys[e.key] = false;
            if (e.key === " ") canShoot = true;
        });

        function shoot() {
            bullets.push({
                x: ship.x + ship.width,
                y: ship.y + ship.height / 2 - 5,
                width: 10,
                height: 10,
                speed: 7
            });
        }

        function ufoShoot() {
            if (ufo && ship.alive) {
                const dx = (ship.x + ship.width / 2) - (ufo.x + ufo.width / 2);
                const dy = (ship.y + ship.height / 2) - (ufo.y + ufo.height / 2);
                const dist = Math.sqrt(dx * dx + dy * dy);
                const speed = 7;

                ufoBullets.push({
                    x: ufo.x + ufo.width / 2,
                    y: ufo.y + ufo.height / 2,
                    dx: (dx / dist) * speed,
                    dy: (dy / dist) * speed,
                    width: 10,
                    height: 10
                });
            }
        }

        function checkCollision(obj1, obj2) {
            const dx = obj1.x - obj2.x;
            const dy = obj1.y - obj2.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            return distance < (obj1.width / 2 + obj2.width / 2);
        }

        function update() {
            if (keys["ArrowUp"] && ship.y > 0) ship.y -= ship.speed;
            if (keys["ArrowDown"] && ship.y + ship.height < canvas.height) ship.y += ship.speed;
            if (keys["ArrowLeft"] && ship.x > 0) ship.x -= ship.speed;
            if (keys["ArrowRight"] && ship.x + ship.width < canvas.width) ship.x += ship.speed;

            bullets.forEach((bullet, index) => {
                bullet.x += bullet.speed;
                if (bullet.x > canvas.width) bullets.splice(index, 1);
            });

            ufo.x -= ufo.speed;
            if (ufo.x + ufo.width < 0) {
                ufo.x = canvas.width;
                ufo.y = Math.random() * (canvas.height - ufo.height);
                ufo.hits = 5;
                ufo.speed *= 1.25;
            }

            bullets.forEach((bullet, bulletIndex) => {
                if (checkCollision(bullet, ufo)) {
                    bullets.splice(bulletIndex, 1);
                    ufo.hits -= 1;
                    if (ufo.hits <= 0) {
                        ufo.x = canvas.width;
                        ufo.y = Math.random() * (canvas.height - ufo.height);
                        ufo.hits = 5;
                        ufo.speed *= 1.25;
                        score += 10;
                        scoreDisplay.textContent = "Pisteet: " + score;
                    }
                }
            });

            ufoBullets.forEach((bullet, index) => {
                bullet.x += bullet.dx;
                bullet.y += bullet.dy;
                if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
                    ufoBullets.splice(index, 1);
                } else if (checkCollision(bullet, ship)) {
                    ship.alive = false;
                }
            });

            if (!ship.alive) {
                clearInterval(scoreInterval);
                clearInterval(ufoShootingInterval);
            }
        }

        function draw() {
            ctx.drawImage(images.background, 0, 0, canvas.width, canvas.height);
            ctx.drawImage(images.ship, ship.x, ship.y, ship.width, ship.height);
            ctx.drawImage(images.ufo, ufo.x, ufo.y, ufo.width, ufo.height);

            bullets.forEach(bullet => {
                ctx.drawImage(images.bullet, bullet.x, bullet.y, bullet.width, bullet.height);
            });

            ufoBullets.forEach(bullet => {
                ctx.fillStyle = "red";
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            });
        }

        function gameLoop() {
            if (ship.alive) {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            } else {
                ctx.fillStyle = "white";
                ctx.font = "30px Arial";
                ctx.fillText("Game Over", canvas.width / 2 - 80, canvas.height / 2);
                ctx.fillText("Pisteet: " + score, canvas.width / 2 - 80, canvas.height / 2 + 30);

                const existingButton = document.getElementById("restartButton");
                if (existingButton) {
                    document.body.removeChild(existingButton);
                }
                const restartButton = document.createElement("button");
                restartButton.textContent = "Uudelleen";
                restartButton.id = "restartButton";
                document.body.appendChild(restartButton);
                restartButton.addEventListener("click", () => {
                    document.body.removeChild(restartButton);
                    resetGame();
                    init();
                    gameLoop();
                });
            }
        }

        init();
        gameLoop();
    </script>
</body>
</html>