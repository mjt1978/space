<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Crush</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-image: url('skynews-planet-earth-sun_6072586.jpg');
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #startScreen {
            text-align: center;
            color: white;
        }

        #startScreen h1 {
            font-size: 64px;
            margin-bottom: 40px;
        }

        #startScreen button {
            font-size: 24px;
            padding: 10px 20px;
            margin: 10px;
        }

        #gameContainer {
            display: none;
        }

        canvas {
            display: block;
        }

        #gameOver,
        #levelCompleted {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            text-align: center;
        }

        #gameOver h1,
        #levelCompleted h1 {
            font-size: 48px;
            color: red;
            margin: 0;
        }

        #gameOver button,
        #levelCompleted button {
            font-size: 24px;
            padding: 10px 20px;
            margin-top: 20px;
        }

        #ufoCounter {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: white;
        }
    </style>
</head>

<body>
    <div id="startScreen">
        <h1>Space Crush</h1>
        <button onclick="startGame(1)">Taso 1</button>
        <button onclick="startGame(2)">Taso 2</button>
        <button onclick="startGame(3)">Taso 3</button>
        <button onclick="startGame(4)">Taso 4</button>
        <button onclick="startGame(5)">Taso 5</button>
    </div>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="ufoCounter">Tuhotut Ufot: 0</div>
        <div id="gameOver">
            <h1>Game Over</h1>
            <button onclick="restartGame()">Restart</button>
        </div>
        <div id="levelCompleted">
            <h1>Level Completed</h1>
            <button onclick="restartGame()">Restart</button>
        </div>
    </div>
    <script>
        const startScreen = document.getElementById('startScreen');
        const gameContainer = document.getElementById('gameContainer');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const playerImage = new Image();
        playerImage.src = 'alus.png';

        const originalEnemyImageSrc = 'ufo2.png';
        const midEnemyImageSrc = 'ufo4.png';
        const finalEnemyImageSrc = 'ufo3.png';
        const largerEnemyImageSrc = 'ufo5.png';
        const enemyImage = new Image();
        enemyImage.src = originalEnemyImageSrc;

        const bulletImage = new Image();
        bulletImage.src = 'rockets_PNG13272.png';

        const enemyBulletImage = new Image();
        enemyBulletImage.src = 'boss_shot.png';

        let destroyedUFOs = 0;
        let levelCompleted = false;
        let currentLevel = 1;

        class GameObject {
            constructor(image, x, y, width, height) {
                this.image = image;
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.speed = 5;
                this.isDestroyed = false;
                this.exploding = false;
                this.explosionFrame = 0;
            }

            draw() {
                if (!this.isDestroyed) {
                    if (this.exploding) {
                        ctx.save();
                        ctx.globalAlpha = (this.explosionFrame % 2 === 0) ? 1 : 0.5;
                        ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
                        ctx.globalAlpha = 1;
                        ctx.restore();
                        this.explosionFrame++;
                        if (this.explosionFrame > 10) {
                            this.isDestroyed = true;
                        }
                    } else {
                        ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
                    }
                }
            }
        }

        class Player extends GameObject {
            constructor(image, x, y, width, height) {
                super(image, x, y, width, height);
                this.speed = 7;
                this.canShoot = true;
            }

            move() {
                if (keys['ArrowUp'] && this.y > 0) this.y -= this.speed;
                if (keys['ArrowDown'] && this.y < canvas.height - this.height) this.y += this.speed;
                if (keys['ArrowLeft'] && this.x > 0) this.x -= this.speed;
                if (keys['ArrowRight'] && this.x < canvas.width - this.width) this.x += this.speed;
            }

            shoot() {
                if (this.canShoot) {
                    bullets.push(new Bullet(bulletImage, this.x + this.width, this.y + this.height / 2 - 5, 20, 10));
                    this.canShoot = false;
                }
            }
        }

        class Enemy extends GameObject {
            constructor(image, x, y, width, height, health = 6, speed = 3) {
                super(image, x, y, width, height);
                this.health = health;
                this.speed = speed;
                this.fireCooldown = 60;
                this.fireCounter = 0;
                this.isSplitting = false;
                this.isFinalEnemy = false;
            }

            follow(player) {
                const playerCenterX = player.x + player.width / 2;
                const playerCenterY = player.y + player.height / 2;
                const enemyCenterX = this.x + this.width / 2;
                const enemyCenterY = this.y + this.height / 2;

                const deltaX = playerCenterX - enemyCenterX;
                const deltaY = playerCenterY - enemyCenterY;
                const angle = Math.atan2(deltaY, deltaX);

                this.x += this.speed * Math.cos(angle);
                this.y += this.speed * Math.sin(angle);
            }

            takeDamage() {
                if (this.exploding) return;
                this.health -= 1;
                if (this.health <= 0) {
                    if (this.isSplitting) {
                        this.split();
                    } else if (this.isFinalEnemy) {
                        this.exploding = true;
                        showLevelCompleted();
                    } else {
                        this.exploding = true;
                        destroyedUFOs += 1;
                        document.getElementById('ufoCounter').textContent = `Tuhotut Ufot: ${destroyedUFOs}`;
                        if (destroyedUFOs >= 15 && currentLevel === 1) {
                            levelCompleted = true;
                            showLevelCompleted();
                        }
                    }
                }
            }

            split() {
                this.isDestroyed = true;
                enemies.push(new Enemy(enemyImage, this.x, this.y, this.width / 2, this.height / 2));
                enemies.push(new Enemy(enemyImage, this.x, this.y, this.width / 2, this.height / 2));
            }

            fire(player) {
                if (this.fireCounter <= 0) {
                    const bulletX = this.x + this.width / 2;
                    const bulletY = this.y + this.height / 2;
                    const angle = Math.atan2(player.y - bulletY, player.x - bulletX);

                    enemyBullets.push(new EnemyBullet(enemyBulletImage, bulletX, bulletY, 15, 15, angle, this.isFinalEnemy ? 10 : 5));
                    this.fireCounter = this.fireCooldown / (this.isFinalEnemy ? 2 : 1);
                } else {
                    this.fireCounter--;
                }
            }
        }

        class Bullet extends GameObject {
            constructor(image, x, y, width, height) {
                super(image, x, y, width, height);
                this.speed = 10;
            }

            move() {
                this.x += this.speed;
                if (this.x > canvas.width) {
                    this.isDestroyed = true;
                }
            }
        }

        class EnemyBullet extends GameObject {
            constructor(image, x, y, width, height, angle, speed = 5) {
                super(image, x, y, width, height);
                this.angle = angle;
                this.speed = speed;
            }

            move() {
                this.x += this.speed * Math.cos(this.angle);
                this.y += this.speed * Math.sin(this.angle);
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                    this.isDestroyed = true;
                }
            }
        }

        const player = new Player(playerImage, 50, canvas.height / 2, 100, 100);
        let enemies = [];
        let bullets = [];
        let enemyBullets = [];
        let gameRunning = true;

        let keys = {};
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ' && gameRunning) {
                player.shoot();
            }
        });
        window.addEventListener('keyup', (e) => {
            delete keys[e.key];
            if (e.key === ' ') {
                player.canShoot = true;
            }
        });

        function checkCollision(obj1, obj2) {
            const distX = obj1.x + obj1.width / 2 - (obj2.x + obj2.width / 2);
            const distY = obj1.y + obj1.height / 2 - (obj2.y + obj2.height / 2);
            const distance = Math.sqrt(distX * distX + distY * distY);

            return distance < obj1.width / 2 + obj2.width / 2;
        }

        function showGameOver() {
            document.getElementById('gameOver').style.display = 'block';
            gameRunning = false;
        }

        function hideGameOver() {
            document.getElementById('gameOver').style.display = 'none';
            gameRunning = true;
        }

        function showLevelCompleted() {
            document.getElementById('levelCompleted').style.display = 'block';
            gameRunning = false;
            startEndAnimation();
        }

        function hideLevelCompleted() {
            document.getElementById('levelCompleted').style.display = 'none';
            gameRunning = true;
        }

        function startEndAnimation() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const moveSpeed = 5;
            const scaleSpeed = 0.05;
            let scale = 1;

            function moveToCenter() {
                const dx = centerX - (player.x + player.width / 2);
                const dy = centerY - (player.y + player.height / 2);
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance > moveSpeed) {
                    const angle = Math.atan2(dy, dx);
                    player.x += moveSpeed * Math.cos(angle);
                    player.y += moveSpeed * Math.sin(angle);
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    player.draw();
                    requestAnimationFrame(moveToCenter);
                } else {
                    player.x = centerX - player.width / 2;
                    player.y = centerY - player.height / 2;
                    animateScaling();
                }
            }

            function animateScaling() {
                if (scale < 10) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    const newWidth = player.width * scale;
                    const newHeight = player.height * scale;
                    const newX = centerX - newWidth / 2;
                    const newY = centerY - newHeight / 2;
                    ctx.drawImage(player.image, newX, newY, newWidth, newHeight);
                    scale += scaleSpeed;
                    requestAnimationFrame(animateScaling);
                }
            }

            moveToCenter();
        }

        function restartGame() {
            player.x = 50;
            player.y = canvas.height / 2;
            player.isDestroyed = false;
            player.exploding = false;
            player.explosionFrame = 0;

            enemyImage.src = originalEnemyImageSrc;
            enemies = [];
            if (currentLevel === 1) {
                enemies.push(new Enemy(enemyImage, canvas.width - 150, Math.random() * (canvas.height - 100), 200, 200));
            } else if (currentLevel === 2) {
                const largeEnemy = new Enemy(largerEnemyImageSrc, canvas.width - 200, Math.random() * (canvas.height - 200), 400, 400, 18, 3);
                largeEnemy.isSplitting = true;
                enemies.push(largeEnemy);
            }
            bullets = [];
            enemyBullets = [];
            destroyedUFOs = 0;
            levelCompleted = false;
            document.getElementById('ufoCounter').textContent = `Tuhotut Ufot: ${destroyedUFOs}`;
            hideGameOver();
            hideLevelCompleted();
            requestAnimationFrame(update);
        }

        function startGame(level) {
            currentLevel = level;
            startScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            restartGame();
        }

        function update() {
            if (!gameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            player.move();
            player.draw();

            bullets.forEach(bullet => {
                bullet.move();
                bullet.draw();
            });

            bullets.filter(bullet => !bullet.isDestroyed).forEach(bullet => {
                enemies.forEach(enemy => {
                    if (bullet.x < enemy.x + enemy.width &&
                        bullet.x + bullet.width > enemy.x &&
                        bullet.y < enemy.y + enemy.height &&
                        bullet.y + bullet.height > enemy.y) {
                        bullet.isDestroyed = true;
                        enemy.takeDamage();
                    }
                });
            });

            enemies = enemies.filter(enemy => !enemy.isDestroyed);

            enemies.forEach(enemy => {
                enemy.follow(player);
                enemy.fire(player);
                enemy.draw();
            });

            enemyBullets.forEach(bullet => {
                bullet.move();
                bullet.draw();
            });

            enemyBullets.filter(bullet => !bullet.isDestroyed).forEach(bullet => {
                if (checkCollision(player, bullet)) {
                    player.exploding = true;
                    player.explosionFrame = 0;
                    showGameOver();
                    return;
                }
            });

            bullets = bullets.filter(bullet => !bullet.isDestroyed);
            enemyBullets = enemyBullets.filter(bullet => !bullet.isDestroyed);

            enemies.forEach(enemy => {
                if (checkCollision(player, enemy)) {
                    player.exploding = true;
                    player.explosionFrame = 0;
                    showGameOver();
                    return;
                }
            });

            requestAnimationFrame(update);
        }

        update();
    </script>
</body>

</html>
